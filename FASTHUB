-- Services
local Players = game:GetService("Players")
local PlayerGui = Players.LocalPlayer:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- Chargement Rayfield UI
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

-- Création fenêtre Rayfield avec Key System
local Window = Rayfield:CreateWindow({
    Name = "FASTHUB",
    LoadingTitle = "FASTHUB",
    LoadingSubtitle = "by FASTHUB",
    ConfigurationSaving = { Enabled = false },
    Discord = {
        Enabled = true,
        Invite = "JhzQkmgMMw",
        RememberJoins = false,
    },
    KeySystem = true, -- Activation du Key System
    KeySettings = {
        Title = "FASTHUB Key System",
        Subtitle = "Authentication Required",
        Note = "Join our Discord to get the key: https://discord.gg/JhzQkmgMMw",
        FileName = "FASTHUBKey",
        SaveKey = true,
        GrabKeyFromSite = false,
        Key = { "NEW_FASTHUB33" }
    }
})

--== Variables Aimbot ==--
local AimbotOn = false
local FOVRadius = 50
local WallCheck = true
local AimPart = "Head"

-- Cercle FOV
local FOVCircle = Drawing.new("Circle")
FOVCircle.Radius = FOVRadius
FOVCircle.Thickness = 1.5
FOVCircle.Transparency = 0.4
FOVCircle.Filled = false
FOVCircle.Color = Color3.new(1,1,1)
FOVCircle.Visible = false

RunService.RenderStepped:Connect(function()
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    FOVCircle.Visible = AimbotOn
end)

-- ESP Player
local ESPEnabled = false
local function createHighlight(char)
    if char:FindFirstChild("FASTHUB_Highlight") then return end
    local highlight = Instance.new("Highlight")
    highlight.Name = "FASTHUB_Highlight"
    highlight.Adornee = char
    highlight.FillColor = Color3.fromRGB(255,255,255)
    highlight.FillTransparency = 0.7
    highlight.OutlineColor = Color3.fromRGB(255,255,255)
    highlight.OutlineTransparency = 0
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.Parent = char
end

local function applyESP(player)
    if player == LocalPlayer then return end
    player.CharacterAdded:Connect(function(char)
        repeat task.wait() until char:FindFirstChild("HumanoidRootPart")
        if ESPEnabled then
            createHighlight(char)
        end
    end)
    if player.Character and ESPEnabled then
        createHighlight(player.Character)
    end
end

for _,player in ipairs(Players:GetPlayers()) do applyESP(player) end
Players.PlayerAdded:Connect(applyESP)

-- Fonctions Aimbot
local function IsVisible(part)
    local origin = Camera.CFrame.Position
    local direction = (part.Position - origin)
    local raycastParams = RaycastParams.new()
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    raycastParams.FilterDescendantsInstances = {LocalPlayer.Character, part.Parent}
    local ray = workspace:Raycast(origin, direction, raycastParams)
    return ray == nil
end

local function GetClosestPlayer()
    local closest, shortestDist = nil, FOVRadius
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild(AimPart) then
            local part = player.Character[AimPart]
            local pos, onScreen = Camera:WorldToViewportPoint(part.Position)
            if onScreen then
                local dist = (Vector2.new(pos.X, pos.Y) - Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).Magnitude
                if dist < shortestDist and (not WallCheck or IsVisible(part)) then
                    shortestDist = dist
                    closest = player
                end
            end
        end
    end
    return closest
end

RunService.RenderStepped:Connect(function()
    if AimbotOn then
        local target = GetClosestPlayer()
        if target and target.Character and target.Character:FindFirstChild(AimPart) then
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, target.Character[AimPart].Position)
        end
    end
end)

--== Enhanced FASTHUB Autofarm GUI ==--
-- Core variables
local farmingEnabled = false
local player = game.Players.LocalPlayer

-- Create a stylish GUI
local fastGui = Instance.new("ScreenGui")
fastGui.Name = "FASTHUB_GUI"
fastGui.ResetOnSpawn = false
fastGui.Enabled = false -- Caché par défaut

-- Try different parent methods based on executor compatibility
local success = pcall(function()
    fastGui.Parent = game:GetService("CoreGui")
end)
if not success then
    fastGui.Parent = player.PlayerGui
end

-- Main frame with rounded corners, gradient and drop shadow
local fastFrame = Instance.new("Frame")
fastFrame.Name = "MainFrame"
fastFrame.Size = UDim2.new(0, 220, 0, 180) -- Taille du cadre
fastFrame.Position = UDim2.new(0.5, -110, 0.5, -90)
fastFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
fastFrame.BorderSizePixel = 0
fastFrame.Active = true
fastFrame.Draggable = true
fastFrame.Parent = fastGui

-- Add rounded corners
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = fastFrame

-- Add drop shadow
local shadow = Instance.new("ImageLabel")
shadow.Name = "Shadow"
shadow.Size = UDim2.new(1, 20, 1, 20)
shadow.Position = UDim2.new(0, -10, 0, -10)
shadow.BackgroundTransparency = 1
shadow.Image = "rbxassetid://5554236805"
shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
shadow.ImageTransparency = 0.6
shadow.ScaleType = Enum.ScaleType.Slice
shadow.SliceCenter = Rect.new(23, 23, 277, 277)
shadow.ZIndex = 0
shadow.Parent = fastFrame

-- Gradient#pragma once background for the frame
local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 40, 60)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 25, 35))
})
gradient.Rotation = 45
gradient.Parent = fastFrame

-- Title container with fancy styling
local titleContainer = Instance.new("Frame")
titleContainer.Name = "TitleContainer"
titleContainer.Size = UDim2.new(1, 0, 0, 40)
titleContainer.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
titleContainer.BorderSizePixel = 0
titleContainer.Parent = fastFrame

-- Add rounded corners to title
local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 8)
titleCorner.Parent = titleContainer

-- Title gradient
local titleGradient = Instance.new("UIGradient")
titleGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(60, 20, 150)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(130, 30, 255))
})
titleGradient.Rotation = 90
titleGradient.Parent = titleContainer

-- Title text
local titleText = Instance.new("TextLabel")
titleText.Name = "Title"
titleText.Size = UDim2.new(1, 0, 1, 0)
titleText.BackgroundTransparency = 1
titleText.Text = "FASTHUB"
titleText.TextColor3 = Color3.fromRGB(255, 255, 255)
titleText.Font = Enum.Font.GothamBold
titleText.TextSize = 18
titleText.Parent = titleContainer

-- Status container with icon and improved visuals
local statusContainer = Instance.new("Frame")
statusContainer.Name = "StatusContainer"
statusContainer.Size = UDim2.new(1, -20, 0, 30)
statusContainer.Position = UDim2.new(0, 10, 0, 50)
statusContainer.BackgroundColor3 = Color3.fromRGB(45, 45, 65)
statusContainer.BorderSizePixel = 0
statusContainer.Parent = fastFrame

-- Add rounded corners to status
local statusCorner = Instance.new("UICorner")
statusCorner.CornerRadius = UDim.new(0, 6)
statusCorner.Parent = statusContainer

-- Status icon
local statusIcon = Instance.new("TextLabel")
statusIcon.Name = "StatusIcon"
statusIcon.Size = UDim2.new(0, 30, 0, 30)
statusIcon.BackgroundTransparency = 1
statusIcon.Text = "⏱️"
statusIcon.TextColor3 = Color3.fromRGB(200, 200, 255)
statusIcon.Font = Enum.Font.GothamBold
statusIcon.TextSize = 16
statusIcon.Parent = statusContainer

-- Status text
local status = Instance.new("TextLabel")
status.Name = "Status"
status.Size = UDim2.new(1, -40, 1, 0)
status.Position = UDim2.new(0, 30, 0, 0)
status.BackgroundTransparency = 1
status.Text = "READY"
status.TextColor3 = Color3.fromRGB(200, 200, 255)
status.Font = Enum.Font.Gotham
status.TextSize = 14
status.TextXAlignment = Enum.TextXAlignment.Left
status.Parent = statusContainer

-- Progress bar container
local progressBarContainer = Instance.new("Frame")
progressBarContainer.Name = "ProgressBarContainer"
progressBarContainer.Size = UDim2.new(1, -20, 0, 6)
progressBarContainer.Position = UDim2.new(0, 10, 0, 85)
progressBarContainer.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
progressBarContainer.BorderSizePixel = 0
progressBarContainer.Parent = fastFrame

-- Rounded corners for progress bar
local progressBarCorner = Instance.new("UICorner")
progressBarCorner.CornerRadius = UDim.new(1, 0)
progressBarCorner.Parent = progressBarContainer

-- Progress bar fill
local progressBarFill = Instance.new("Frame")
progressBarFill.Name = "ProgressBarFill"
progressBarFill.Size = UDim2.new(0, 0, 1, 0)
progressBarFill.BackgroundColor3 = Color3.fromRGB(130, 70, 255)
progressBarFill.BorderSizePixel = 0
progressBarFill.Parent = progressBarContainer

-- Rounded corners for progress bar fill
local progressBarFillCorner = Instance.new("UICorner")
progressBarFillCorner.CornerRadius = UDim.new(1, 0)
progressBarFillCorner.Parent = progressBarFill

-- Gradient for progress bar fill
local progressBarGradient = Instance.new("UIGradient")
progressBarGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(130, 70, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(180, 120, 255))
})
progressBarGradient.Parent = progressBarFill

-- Credits label
local creditsContainer = Instance.new("Frame")
creditsContainer.Name = "CreditsContainer"
creditsContainer.Size = UDim2.new(1, -20, 0, 20)
creditsContainer.Position = UDim2.new(0, 10, 0, 95)
creditsContainer.BackgroundTransparency = 1
creditsContainer.Parent = fastFrame

local creditsLabel = Instance.new("TextLabel")
creditsLabel.Name = "CreditsLabel"
creditsLabel.Size = UDim2.new(1, 0, 1, 0)
creditsLabel.BackgroundTransparency = 1
creditsLabel.Text = "Made by FASTHUB"
creditsLabel.TextColor3 = Color3.fromRGB(180, 180, 220)
creditsLabel.Font = Enum.Font.Gotham
creditsLabel.TextSize = 12
creditsLabel.Parent = creditsContainer

-- Start Button
local startButton = Instance.new("TextButton")
startButton.Name = "StartButton"
startButton.Size = UDim2.new(0.5, -15, 0, 36)
startButton.Position = UDim2.new(0, 10, 1, -46)
startButton.BackgroundColor3 = Color3.fromRGB(40, 180, 120)
startButton.BorderSizePixel = 0
startButton.Text = "▶️ START"
startButton.TextColor3 = Color3.fromRGB(255, 255, 255)
startButton.Font = Enum.Font.GothamBold
startButton.TextSize = 16
startButton.Parent = fastFrame

local startButtonCorner = Instance.new("UICorner")
startButtonCorner.CornerRadius = UDim.new(0, 8)
startButtonCorner.Parent = startButton

-- Stop Button
local stopButton = Instance.new("TextButton")
stopButton.Name = "StopButton"
stopButton.Size = UDim2.new(0.5, -15, 0, 36)
stopButton.Position = UDim2.new(0.5, 5, 1, -46)
stopButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
stopButton.BorderSizePixel = 0
stopButton.Text = "■ STOP"
stopButton.TextColor3 = Color3.fromRGB(255, 255, 255)
stopButton.Font = Enum.Font.GothamBold
stopButton.TextSize = 16
stopButton.Parent = fastFrame

local stopButtonCorner = Instance.new("UICorner")
stopButtonCorner.CornerRadius = UDim.new(0, 8)
stopButtonCorner.Parent = stopButton

-- Functions for updating status and progress
local function updateStatus(text, icon)
    status.Text = text
    if icon then
        statusIcon.Text = icon
    end
end

local function updateProgressBar(percentage)
    progressBarFill:TweenSize(
        UDim2.new(percentage / 100, 0, 1, 0),
        Enum.EasingDirection.Out,
        Enum.EasingStyle.Quad,
        0.2,
        true
    )
end

-- Function to simulate key press E (for actions)
local function pressE()
    pcall(function()
        game:GetService("VirtualInputManager"):SendKeyEvent(true, "E", false, game)
        wait(0.1)
        game:GetService("VirtualInputManager"):SendKeyEvent(false, "E", false, game)
    end)
    pcall(function()
        keypress(0x45)
        wait(0.1)
        keyrelease(0x45)
    end)
    pcall(function()
        keypress(69)
        wait(0.1)
        keyrelease(69)
    end)
end

-- Function to equip an item by name
local function equipItem(itemName)
    updateStatus("EQUIP: " .. itemName, "🔄")
    local backpack = player.Backpack
    local item = backpack:FindFirstChild(itemName)
    if item then
        local character = player.Character or player.CharacterAdded:Wait()
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid:EquipTool(item)
            wait(0.5)
            return true
        end
    else
        updateStatus("NO " .. itemName, "⚠️")
        wait(1)
        return false
    end
    return false
end

-- Main farming function
local function startFarming()
    spawn(function()
        while farmingEnabled do
            -- Exemple d'utilisation (adaptable en fonction du jeu) :
            -- Eau
            if equipItem("Water") then
                updateStatus("USING WATER", "💧")
                pressE()
                for i = 25, 1, -1 do
                    if not farmingEnabled then break end
                    updateStatus("WAIT: " .. i .. "s", "⏱️")
                    updateProgressBar((25 - i) * 4)
                    wait(1)
                end
            else
                farmingEnabled = false
                break
            end

            if not farmingEnabled then break end

            -- Sac de sucre (adaptable)
            if equipItem("Sugar Block Bag") then
                updateStatus("USING SUGAR", "🧂")
                pressE()
                wait(1)
            else
                farmingEnabled = false
                break
            end

            if not farmingEnabled then break end

            -- Gélatine (adaptable)
            if equipItem("Gelatin") then
                updateStatus("USING GELATIN", "🍮")
                pressE()
                for i = 50, 1, -1 do
                    if not farmingEnabled then break end
                    updateStatus("WAIT: " .. i .. "s", "⏱️")
                    updateProgressBar((50 - i) * 2)
                    wait(1)
                end
                if not farmingEnabled then break end
                updateStatus("FINISHING", "✨")
                pressE()
                wait(1)
                if equipItem("Empty Bag") then
                    updateStatus("USING EMPTY BAG", "👜")
                    pressE()
                    wait(1)
                end
            else
                farmingEnabled = false
                break
            end

            updateStatus("CYCLE DONE", "✅")
            updateProgressBar(100)
            wait(1)
            updateProgressBar(0)
        end
        updateStatus("STOPPED", "⏹️")
        updateProgressBar(0)
    end)
end

-- Button functions with hover effects
startButton.MouseEnter:Connect(function()
    startButton:TweenSize(UDim2.new(0.5, -13, 0, 38), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
end)
startButton.MouseLeave:Connect(function()
    startButton:TweenSize(UDim2.new(0.5, -15, 0, 36), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
end)
stopButton.MouseEnter:Connect(function()
    stopButton:TweenSize(UDim2.new(0.5, -13, 0, 38), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
end)
stopButton.MouseLeave:Connect(function()
    stopButton:TweenSize(UDim2.new(0.5, -15, 0, 36), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
end)

startButton.MouseButton1Click:Connect(function()
    if not farmingEnabled then
        farmingEnabled = true
        updateStatus("STARTING...", "🚀")
        startFarming()
    end
end)

stopButton.MouseButton1Click:Connect(function()
    farmingEnabled = false
    updateStatus("STOPPING...", "🛑")
end)

-- Anti-AFK
local VU = game:GetService("VirtualInputManager")
player.Idled:Connect(function()
    VU:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    wait(1)
    VU:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
end)

-- Cool initial animation for progress bar
updateStatus("READY", "✨")
for i = 0, 100, 5 do
    updateProgressBar(i)
    wait(0.01)
end
for i = 100, 0, -5 do
    updateProgressBar(i)
    wait(0.01)
end

print("Enhanced FASTHUB Autofarm GUI loaded! Look for the new GUI in the center of your screen.")

-- Note : L'animation de l'écran de démarrage est commentée car splashScreen n'est pas défini
--[[
spawn(function()
    splashContainer.Position = UDim2.new(0.5, -150, -0.5, -75)
    bouhjarName.TextTransparency = 1
    splashTitle.TextTransparency = 1
    glowEffect.ImageTransparency = 1

    splashContainer:TweenPosition(UDim2.new(0.5, -150, 0.5, -75), Enum.EasingDirection.Out, Enum.EasingStyle.Bounce, 1, true)
    wait(0.5)
    for i = 1, 0, -0.1 do
        splashTitle.TextTransparency = i
        wait(0.05)
    end
    wait(0.3)
    for i = 1, 0, -0.1 do
        bouhjarName.TextTransparency = i
        glowEffect.ImageTransparency = 0.6 + (i * 0.4)
        wait(0.05)
    end
    for i = 1, 3 do
        bouhjarName:TweenSize(UDim2.new(1, 0, 0, 65), Enum.EasingDirection.Out, Enum.EasingStyle.Sine, 0.3, true)
        wait(0.3)
        bouhjarName:TweenSize(UDim2.new(1, 0, 0, 60), Enum.EasingDirection.Out, Enum.EasingStyle.Sine, 0.3, true)
        wait(0.3)
    end
    wait(0.5)
    for i = 0, 1, 0.1 do
        splashScreen.BackgroundTransparency = 0.5 + (i * 0.5)
        splashContainer.BackgroundTransparency = i
        splashTitle.TextTransparency = i
        bouhjarName.TextTransparency = i
        glowEffect.ImageTransparency = 0.6 + (i * 0.4)
        wait(0.05)
    end
    splashScreen.Visible = false
end)
--]]

--== Création des onglets Rayfield ==--

-- Onglet Combat
local CombatTab = Window:CreateTab("Combat", 4483362458)
CombatTab:CreateToggle({
    Name = "Activer Aimbot",
    CurrentValue = false,
    Callback = function(v) AimbotOn = v end,
})
CombatTab:CreateSlider({
    Name = "FOV (10 à 120)",
    Range = {10, 120},
    Increment = 1,
    CurrentValue = FOVRadius,
    Callback = function(v) 
        FOVRadius = v
        FOVCircle.Radius = v
    end,
})
CombatTab:CreateToggle({
    Name = "WallCheck",
    CurrentValue = WallCheck,
    Callback = function(v) WallCheck = v end,
})
CombatTab:CreateToggle({
    Name = "ESP Player",
    CurrentValue = false,
    Callback = function(v)
        ESPEnabled = v
        if v then
            for _, p in ipairs(Players:GetPlayers()) do
                if p.Character then createHighlight(p.Character) end
            end
        else
            for _, p in ipairs(Players:GetPlayers()) do
                if p.Character and p.Character:FindFirstChild("FASTHUB_Highlight") then
                    p.Character:FindFirstChild("FASTHUB_Highlight"):Destroy()
                end
            end
        end
    end,
})

-- Onglet AutoFarm
local AutoFarmTab = Window:CreateTab("AutoFarm", 4483362458)
AutoFarmTab:CreateButton({
    Name = "Afficher / masquer FASTHUB AutoFarm",
    Callback = function()
        fastGui.Enabled = not fastGui.Enabled
        Rayfield:Notify({
            Title = "FASTHUB AutoFarm",
            Content = fastGui.Enabled and "Le GUI FASTHUB AutoFarm est maintenant affiché !" or "Le GUI FASTHUB AutoFarm est maintenant masqué !",
            Duration = 4
        })
    end,
})
AutoFarmTab:CreateLabel("Utilise le bouton ci-dessus pour afficher ou masquer le GUI FASTHUB")

-- Onglet Misc
local MiscTab = Window:CreateTab("Misc", 4483362458)
MiscTab:CreateParagraph({
    Title = "Rejoins notre serveur Discord !",
    Content = "Clique sur le bouton ci-dessous pour copier le lien d’invitation."
})
MiscTab:CreateButton({
    Name = "📋 Copier le lien Discord",
    Callback = function()
        setclipboard("https://discord.gg/JhzQkmgMMw")
        Rayfield:Notify({
            Title = "Lien copié",
            Content = "Le lien du Discord a été copié dans ton presse-papiers !",
            Duration = 4
        })
    end,
})
